<!doctype html>  
<html lang="fr">
	
	<head>
		<meta charset="utf-8">
		
		<title>REST in SPORE - Pycon FR 2012</title>

		<meta name="description" content="Rest in SPORE presentation at Pycon FR 2012">
		<meta name="author" content="Arnaud Grausem">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

                <link rel='stylesheet' href='css/fonts.css'>
		
		<link rel="stylesheet" href="reveal.js/css/main.css">
		<link rel="stylesheet" href="reveal.js/css/theme/beige.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="reveal.js/lib/css/zenburn.css">

		<script>
			// If the query includes 'print-pdf' we'll use the PDF print sheet
			document.write( '<link rel="stylesheet"
                        href="reveal.js/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>
	
	<body>
		
		<div class="reveal">

			<!-- Used to fade in a background when a specific slide state is reached -->
			<div class="state-background"></div>
			
			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

				<section data-markdown>
                                    <h1>REST in SPORE</h1>

                                    <h3>PyconFR 2012 - Paris</h3>
				</section>

                                <section>
                                <h2>Arnaud Grausem</h2>
                                <p>Université de Strasbourg / Direction
                                Informatique</p>
                                <p>Responsable des développements<p>
                                <p><i><small>- <a
                                href="http://github.com/agrausem">github.com/agrausem</a>
                                / <a href="http://twitter.com/agrausem">@agrausem</a></small></i></a>
                                </section>

                                <section>
                                <h2>État des lieux</h2>
                                    <p>Système d'information hétérogéne</p>
                                    <p>API lourdes Java</p>
                                </section>
                                <section>
                                <h2>Faits d'arme</h2>
                                    <p>Python, langage officiel</p>
                                    <p>Web APIs REST</p>
                                    <p>Clients</p>
                                </section>
                                <section>
                                <h2>Problème</h2>
                                    <p>répétitif</p>
                                    <p>lassant</p>
                                    <p>tout sauf sexy</p>                                
                                </section>
                                <section>
                                <h2>Ça suffit !</h2>
                                    <pre><code python>
def _BuildUrl(self, url, path_elements=None, extra_params=None):
    # Break url into consituent parts
    (scheme, netloc, path, params, query, fragment) = urlparse.urlparse(url)

    # Add any additional path elements to the path
    if path_elements:
        # Filter out the path elements that have a value of None
        p = [i for i in path_elements if i]
        if not path.endswith('/'):
            path += '/'
            path += '/'.join(p)

    # Add any additional query parameters to the query string
    if extra_params and len(extra_params) > 0:
        extra_query = self._EncodeParameters(extra_params)
        # Add it to the existing query
        if query:
            query += '&' + extra_query
        else:
            query = extra_query
    # Return the rebuilt URL
    return urlparse.urlunparse((scheme, netloc, path, params, query, fragment))
                                    </code></pre>
                                </section>

                                <section>
                                    <h2>Idée</h2>
                                    <p>laisser la machine faire</p>
                                    <p>comment ?</p>
                                    <p>une librairie ?</p>
                                    <p>chercher autre part ?</p>
                                </section>

                                <section>
                                    <h2>Linkfluence</h2>
                                    <p>http://fr.linkfluence.net</p>
                                    <p>Franck Cuny, Nils Grünwald</p>
                                    <img src="img/mordor.jpg" width="650" height="500">
                                </section>

                                <section>
                                    <h3>Constat</h3>
                                    <p class="">Implémentation systématique de la gestion :
                                    <ul>
                                        <li class="">des requêtes et des réponses HTTP</li>
                                        <li class="">de l'authentification et des autorisations</li>
                                        <li class="">des formats de réception des données</li>
                                    </ul>
                                </section>

                                <section>
                                    <h3>Et pourtant... pour quel objectif ?</h3>
                                    <p class="">Envoyer des données</p>
                                    <p class="">Traiter des données receptionnées</p>
                                    <br/>
                                </section>

                                <section>    
                                    <h3>One specification to rule them all</h3>
                                    <img src="img/ring.jpg">
                                </section>

                                <section>
                                    <h2>SPORE</h2>

                                    <h3><a href="https://github.com/SPORE/specifications">Specification to a POrtable Rest Environment</a></h3>

                                    <p class="">Décrire des API Web REST</p>
                                    <p class="">Document texte simple et lisible : JSON</p>
                                    <p class="">Implémentations spécifiques à
                                    chaque langage</p>
                                </section>

                                <section>
                                   <h2>But</h2>
                                     <p>API cliente simple</p>
                                     <p>compréhensible</p>
                                     <p>se concentrer sur la logique du client</p>
                                     <p>gagner du temps</p>
                                     <img class="fragment" src='img/karmeliet.jpg' height="380"/>
                                </section>

                                <section>
                                <h3>Ecosystème</h3>
                                <p>communauté grandissante</p>
                                <p>un prêcheur infatigable: Camille
                                Maussang</p>
                                </section>
                                <section>
                                <h3>Implémentations</h3>
                                <p>Des clients ont été implémentés et sont
                                fonctionnels en:</p>
                                <ul>
                                    <li class=""><a
                                        href="https://github.com/franckcuny/net-http-spore">Perl</a>
                                        - Franck Cuny</li>
                                        <li class=""><a href="">Lua</a>
                                        - Franck Perrad</li>
                                    <li class=""><a
                                        href="https://github.com/sukria/Ruby-Spore">Ruby</a>
                                    - Alexis Sukrieh</li>
                                    <li class=""><a
                                        href="https://github.com/fperrad/lua-Spore/">Clojure</a> - Niel Grünwald</li>
                                    <li class=""><a
                                        href="https://github.com/nikopol/jquery-spore">jQuery</a>
                                    - Nikopol
                                    <li class=""><a
                                        href="https://github.com/francois2metz/node-spore">node.js</a>
                                - François de Metz</li>
                                    <li><a
                                    href="https://github.com/bins/PHP-Spore">PHP</a>
                                    - Bin SHU</li>
                                <li class="">et même <a
                                    href="https://github.com/francois2metz/node-spore">Java !</a> - Nicolas Yzet</li>
                                </ul>
                                </section>

                                <section data-state="image-blocker">
                                <h3>Descriptions</h3>
                                <p>https://github.com/SPORE/api-description</p>
                                <img id="map0" src="img/map.jpg" width="650"
                                height="500"/>
                                <img id="map1" class="fragment"
                                src="img/map1.jpg" width=650" height="500"/>
                                <img id="map2" class="fragment"
                                src="img/map2.jpg" width=650" height="500"/>
                                </section>

                                <section>
                                <h3>Acmeism</h3>
                                <p>une description à jour</p>
                                <p>tous les clients à jour</p>
                                <p>pour tous les langages</p>
                                </section>

                                <section>
                                <h3>Et Python ?</h3>
                                <img class="fragment" src="img/meet_the_ring.jpg"/>
                                </section>

                                <section>
                                <h3>Spyre</h3>
                                <p class="">en cours de développement</p>
                                <p class="">par Damien Leroux, Franck
                                Cuny et moi-même</p>
                                <p class="">dépôt officiel : https://github.com/blob/sypre<p>
                                <p class="">mon fork: https://github.com/agrausem/spyre</p>
                                </section>

                                <section>
                                <h2>La spécification</h2>
                                <p class="">comment décrire un service
                                REST</p>
                                <p class="">comment implémenter un
                                client</p>
                                <p class=""></p>comment implémenter des middlewares
                                </section>
                                <section>
                                <h3>Décrire un service Web - Généralités</h3>
                                <pre><code class="javascript">

{
   "name" : "Redmine API",
   "authority" : "GITHUB:Keen-github",
   "base_url": "http://redmine.domain.fr",
   "formats" : [
      "json",
      "xml"
   ],
   "version" : "0.1",
   "meta" : {
      "documentation" : "http://www.redmine.org/projects/redmine/wiki/Rest_api",
      "authors" : "LogicEditor.com: Valeriy Skurikhin"
   }
   "methods" : {
       ...
   },
}
                                </code></pre>
                                </section>
                                <section>
                                    <h3>Décrire un service Web - Les méthodes</h3>
                                    <pre><code class="javascript">
"methods": {
     "get_user" : {
         "path" : "/users/:id.:format", 
         "required_params" : [
            "id",
            "format"
         ],
         "method" : "GET",
         "authentication" : true
    },
    "list_users" : {
         "path" : "/users.:format", 
         "required_params" : [
            "format"
         ],
         "optional_params" : [
            "limit",
            "offset"
         ],
         "method" : "GET",
         "authentication" : true
      },
    ...
},</code></pre>
                                </section>
                                <section>
                                    <h3>Implémenter un client</h3>
                                    <p class="">construction
                                    d'un client Spore à partir d'une spécification</p>
                                    <p class="">meta-programming</p>
                                    <p class="">
                                    activation / désactivation de middlewares en
                                    cours d'exécution</p>
                                    <pre class="fragment"><code class="python">
import spyre

client = spyre.new_from_spec('redmine.json')
client.enable('auth.Basic', username="toto", password="tata")
                                    </pre></code>
                                </section>
                                <section>
                                    <h3>Appel de méthodes</h3>
                                        <p>depuis l'objet client généré</p>
                                        <p class="">des arguments
                                        obligatoires</li>
                                        <p class="">des
                                        arguments optionnels</li>
                                </section>
                                <section>
                                   <h3>Exécution d'une méthode</h3>
                                        <p class="">construction
                                        de l'environnement de la requête</p>
                                        <p class="">prise en charge
                                        les middlewares activés</p>
                                        <p class="">envoie de la requête</p>
                                        <p class="">contrôle des codes
                                        de retour de la réponse</p>
                                </section>
                                <section>
                                    <h3>Exemple</h3>
                                    <pre><code python>
import spyre

client = spyre.new_from_spec('redmine.json',
                base_url="https://my-redmine.mydomain.org")
client.enable('auth.Basic', username="toto", password="tata")

response = client.get_user(id='3', format='json')

assert(reponse.base, "http://my-redmine.mydomain.org:443/users/3.json")
assert(response.status, "200")

my_user = response.content

assert(my_user,
'{"user":{"lastname":"Toto","login":"toto","firstname":"Toto",
"mail":"toto@gmail.com","created_on":"2012/01/05 16:47:32 +0100",
"last_login_on":"2012/09/06 18:27:26 +0200","id":3}}'
)
                                    </code></pre>
                                </section>
                                <section>
                                <h3>L'environnement de la requête</h3>
                                    <p class="">une structure de
                                    données (e.g. dictionnaire)</p>
                                    <p class="">certaines clés -> WSGI (PEP333)</p> 
                                    <p class="">d'autres -> définies par et pour SPORE</p>
                                    <p class="">modifiable durant
                                    l'éxecution par les middlewares</p>
                                    <p class="">utilisée pour
                                    construire la requête finale</p>
                                </section>
                                <section>
                                    <h3>Exemple</h3>
                                    <pre><code python>
{
    'spore.headers': [('Authorization', 'Basic dG90bzp0YXRh')],
    'HTTP_USER_AGENT': 'spyre', 
    'SERVER_NAME': 'my-redmine.mydomain.org',
    'spore.userinfo': None, 
    'spore.authentication': True, 
    'SCRIPT_NAME': ['', 'redmine'],
    'spore.url_scheme': 'https',
    'spore.formats': None,
    'spore.payload': 'payload', 
    'REQUEST_METHOD': u'GET',
    'spore.expected_status': [],
    'PATH_INFO': u'/users/:id.:format',
    'SERVER_PORT': 443,
    'spore.errors': '',
    'QUERY_STRING': '',
    'spore.params': ['id', '3', 'format', 'json'],
    'REQUEST_URI': ''
}
                                    </code></pre>
                                </section>
                                <section>
                                    <h3>Les middlewares</h3>
                                        <p class="">modifier
                                        l'environnement de la requête</p>
                                        <p class="">activer un
                                        callback</p>
                                        <p class="">retourner
                                        directement une réponse</p>
                                </section>

                                <section>
                                <h3>Exemple</h3>
                                <pre><code python>
import spyre

client = spyre.new_from_spec('redmine.json',
                base_url="https://my-redmine.mydomain.org")
client.enable('auth.Basic', username="toto", password="tata")
client.enable('format.Json')

response = client.get_user(id='3', format='json')
my_user = response.content

assert(type(my_user, dict))
assert(my_user['user']['login'], 'toto')

                                </pre></code>
                                </section>
                                <section>
                                <h3>Spyre - Fonctionnalités</h3>
                                <p class="">méthodes GET et DELETE</p>
                                <p class="">authentification Basic et via Header</p>
                                <p class="">format JSON</p>
                                </section>
                                <section>
                                <h3>Spyre - Reste à faire</h3>
                                <p class="">autres formats (e.g. XML,
                                etc)</p>
                                <p class="">gestion du payload pour
                                POST et PUT</p>
                                <p class="">autres verbes HTTP (e.g
                                PATCH, etc...)
                                <p class="">oauth</p>
                                <p class="">ménage !</p>
                                </section>
                                <section>
                                <h3>Demain ?</h3>
                                <p>(Ré)spyre(r)</p>
                                <img class="fragment" src="img/gollum.jpg"/>
                                </section>
                                <section>
                                <h3>Merci !</h3>
                                <img class="fragment" src="img/sauron.jpg"
                                width="650" height="500">
                                </section>
			</div>

			<!-- The navigational controls UI -->
			<aside class="controls">
				<a class="left" href="#">&#x25C4;</a>
				<a class="right" href="#">&#x25BA;</a>
				<a class="up" href="#">&#x25B2;</a>
				<a class="down" href="#">&#x25BC;</a>
			</aside>

			<!-- Presentation progress bar -->
			<div class="progress"><span></span></div>
			
		</div>

		<script src="reveal.js/lib/js/head.min.js"></script>
		<script src="reveal.js/js/reveal.min.js"></script>

		<script>
			
			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				
				theme: Reveal.getQueryHash().theme || 'default', // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/linear(2d)

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'reveal.js/lib/js/highlight.js', async: true, callback: function() { window.hljs.initHighlightingOnLoad(); } },
					{ src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'reveal.js/lib/js/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'reveal.js/lib/js/data-markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '/socket.io/socket.io.js', async: true, condition: function() { return window.location.host === 'localhost:1947'; } },
					{ src: 'reveal.js/plugin/speakernotes/client.js', async: true, condition: function() { return window.location.host === 'localhost:1947'; } },
				]
			});

                        Reveal.addEventListener('fragmentshown', function(event) {
                            var id = parseInt(event.fragment.id[3]) - 1;
                            if (id < 4) {
                                to_hide = document.getElementById("map" + id)
                                to_hide.style.display = "none";
                            }
                        })
			
		</script>

	</body>
</html>
